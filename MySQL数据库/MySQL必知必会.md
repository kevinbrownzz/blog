---
title: MySQL必知必会 阅读笔记
date: 2024-3-1 13:31:40
type: 数据库
categories: 数据库
cover: https://img9.doubanio.com/view/subject/l/public/s5968156.jpg
---
# MySQL必知必会 阅读笔记
### 1.主键概念
表中的任何列都可以作为主键，只要它满足以下条件：

❑ 任意两行都不具有相同的主键值；

❑ 每个行都必须具有一个主键值（主键列不允许NULL值）

表中的任何列都可以作为主键，只要它满足以下条件：❑ 任意两行都不具有相同的主键值；❑ 每个行都必须具有一个主键值（主键列不允许NULL值）

主键的最好习惯 除MySQL强制实施的规则外，应该坚持的几个普遍认可的最好习惯为：❑ 不更新主键列中的值；❑ 不重用主键列的值；❑ 不在主键列中使用可能会更改的值
### 2.databases和tables的选择
```sql
show databases  

show tables;    
show columns from 表名 == describe 表明
```
❑ SHOW STATUS，用于显示广泛的服务器状态信息；  
❑ SHOW CREATE DATABASE和SHOW CREATE TABLE，分别用来显示创建特定数据库或表的MySQL语句；  
❑ SHOW GRANTS，用来显示授予用户（所有用户或特定用户）的安全权限；   
❑ SHOW ERRORS和SHOW WARNINGS，用来显示服务器错误或警告消息。  

### 3.DISTINCT关键字
使用DISTINCT关键字，顾名思义，此关键字指示MySQL只返回不同的值。  
SELECT DISTINCT vend_id告诉MySQL只返回不同（唯一）的vend_id

### 4.限制结果
SELECT语句返回所有匹配的行，它们可能是指定表中的每个行。为
了返回第一行或前几行，可使用LIMIT子句。下面举一个例子
```sql
SELECT * FROM 表名 LIMIT 5;
```
LIMIT 5, 5指示MySQL返回从行5开始的5行。第一个数为开始
位置，第二个数为要检索的行数。   
所以，带一个值的LIMIT总是从第一行开始，给出的数为返回的行数。
带两个值的LIMIT可以指定从行号为第一个值的位置开始。
```sql
SELECT * FROM 表名 LIMIT 5，5;
```
MySQL 5支持LIMIT的另一种替代语法。LIMIT
4 OFFSET 3意为从行3开始取4行，就像LIMIT 3, 4一样。

### 5.排序数据
子句（clause） SQL语句由子句构成，有些子句是必需的，而
有的是可选的。一个子句通常由一个关键字和所提供的数据组
成。子句的例子有SELECT语句的FROM子句，我们在前一章看到过这个子
句
```sql
SELECT 列名A FROM 表名 ORDER BY 列名B;
```
这条语句除了指示MySQL对B列以字母顺序排序数据  
用非检索的列排序数据是完全合法的。  
#### 5.1 按多个列排序
经常需要按不止一个列进行数据排序。例如，如果要显示雇员清单，
可能希望按姓和名排序（首先按姓排序，然后在每个姓中再按名排序）。
如果多个雇员具有相同的姓，这样做很有用。为了按多个列排序，只要指定列名，列名之间用逗号分开即可（就
像选择多个列时所做的那样）。
```sql
SELECT 列名A FROM 表名 ORDER BY 列名B，列名C;
```
重要的是理解在按多个列排序时，排序完全按所规定的顺序进行。
换句话说，对于上述例子中的输出，仅在多个行具有相同的B
值时才对产品按C进行排序。如果B列中所有的值都是唯一的，则不会按C排序。
#### 5.2 指定排序方向
数据排序不限于升序排序（从A到Z）。这只是默认的排序顺序，还可
以使用ORDER BY子句以降序（从Z到A）顺序排序。为了进行降序排序，
必须指定DESC关键字。
```sql
SELECT 列名A FROM 表名 ORDER BY 列名B DESC;
```
**DESC关键字只应用到直接位于其前面的列名**
```sql
SELECT 列名A FROM 表名 ORDER BY 列名B DESC，列名C;
```
**本章学习了如何用SELECT语句的ORDER BY子句对检索出的数据进行
排序。这个子句必须是SELECT语句中的最后一条子句。**

### 6.WHERE 过滤
表6-1 WHERE子句操作符
操 作 符 说 明

| 操作符| 说明 | 
|-------|-------|
| = | 等于 |
| <> , !=| 不等于|
| < <= > >= | 小于，小于等于，大于，大于等于| 
|BETWEEN | 在指定的两个值之间|
```sql
SELECT * FROM 表名 WHERE 列名 BETWEEN 1 AND 10;
```
#### 6.1 空值检查
在创建表时，表设计人员可以指定其中的列是否可以不包含值。在
一个列不包含值时，称其为包含空值NULL
```sql
SELECT * FROM 表名 WHERE 列名 IS NULL;
```

#### 6.2 组合WHERE子句
为了进行更强的过滤控制，MySQL允许给出多个WHERE子句。这些子
句可以两种方式使用：**以AND子句的方式或OR子句的方式使用**  
使用AND操作符给WHERE子句附加
条件。下面的代码给出了一个例子
```sql
SELECT * FROM 表名 WHERE 列名A = 1 AND 列名B <= 10;
```
```sql
SELECT * FROM 表名 WHERE 列名A = 1 OR 列名B <= 10;
```
**SQL（像多数语言一样）在处理OR操作符前，优先处理AND操
作符,此问题的解决方法是使用圆括号明确地分组相应的操作符。**
#### 6.3 IN操作符
圆括号在WHERE子句中还有另外一种用法。IN操作符用来指定条件范
围，范围中的每个条件都可以进行匹配。IN取合法值的由逗号分隔的清
单，全都括在圆括号中。下面的例子说明了这个操作符：
```sql
SELECT * FROM 表名 WHERE 列名A IN (1000,1001);
```
#### 6.4 NOT操作符
WHERE子句中的NOT操作符有且只有一个功能，那就是否定它之后所
跟的任何条件

### 7.通配符过滤
通配符（wildcard） 用来匹配值的一部分的特殊字符。
#### 7.1 LIKE操作符
##### 7.1.1 百分号（%）通配符
最常使用的通配符是百分号（%）。在搜索串中，%表示任何字符出现
任意次数。例如，为了找出所有以词jet起头的产品，可使用以下SELECT
语句：将检索任意以jet起头的词。%告诉MySQL接受jet之后的任意字符，不管它有多少字符。
```sql
SELECT * FROM 表名 WHERE 列名A LIKE 'jet%';
```
通配符可在搜索模式中任意位置使用，并且可以使用多个通配符。
下面的例子使用两个通配符，它们位于模式的两端：
```sql
SELECT * FROM 表名 WHERE 列名A LIKE '%jet%';
```
搜索模式'%jet%'表示匹配任何位置包含文本jet的值，而
不论它之前或之后出现什么字符。

重要的是要注意到，除了一个或多个字符外，%还能匹配0个字符。%
代表搜索模式中给定位置的0个、1个或多个字符
##### 7.1.2 下划线（_）通配符
另一个有用的通配符是下划线（_）。下划线的用途与%一样，但下划
线只匹配单个字符而不是多个字符。

#### 7.2 使用通配符的技巧
正如所见，MySQL的通配符很有用。但这种功能是有代价的：通配
符搜索的处理一般要比前面讨论的其他搜索所花时间更长。这里给出一些使用通配符要记住的技巧。  
 不要过度使用通配符。如果其他操作符能达到相同的目的，应该
使用其他操作符。  
 在确实需要使用通配符时，除非绝对有必要，否则不要把它们用
在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起
来是最慢的。  
 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据

### 8.用正则表达式进行搜索
仅为正则表达式语言的一个子集 如果你熟悉正则表达式，需
要注意：MySQL仅支持多数正则表达式实现的一个很小的子
集。本章介绍MySQL支持的大多数内容
```sql
SELECT * FROM 表名 WHERE 列名A REGEXP '1000';
```
除关键字LIKE被REGEXP替代外，这条语句看上去非常像使用
LIKE的语句。它告诉MySQL：REGEXP后所跟的东西作
为正则表达式（与文字正文1000匹配的一个正则表达式）处理
```sql
SELECT * FROM 表名 WHERE 列名A REGEXP '.000';
```
这里使用了正则表达式  .000。.是正则表达式语言中一个特殊
的字符。它表示匹配任意一个字符，因此，1000和2000都匹配
且返回
#### 8.2 进行OR匹配
为搜索两个串之一（或者为这个串，或者为另一个串），使用|，如
下所示：
```sql
SELECT * FROM 表名 WHERE 列名A REGEXP '1000|2000';
```

#### 8.3 匹配几个字符之一
```sql
SELECT * FROM 表名 WHERE 列名A REGEXP '[123]ton';
```
这里，使用了正则表达式[123] Ton。[123]定义一组字符，它
的意思是匹配1或2或3，因此，1 ton和2 ton都匹配且返回（没
有3 ton）
#### 8.4 匹配范围
集合可用来定义要匹配的一个或多个字符。例如，下面的集合将匹
配数字0到9：
为简化这种类型的集合，可使用-来定义一个范围。下面的式子功能
上等同于上述数字列表：
范围不限于完整的集合，[1-3]和[6-9]也是合法的范围。此外，范
围不一定只是数值的，[a-z]匹配任意字母字符
```sql
SELECT * FROM 表名 WHERE 列名A REGEXP '[1-3]ton';
```

#### 8.5 匹配特殊字符
正则表达式语言由具有特定含义的特殊字符构成。我们已经看到.、[]、|和-等，还有其他一些字符。请问，如果你需要匹配这些字符，应该怎么办呢？例如，如果要找出包含.字符的值，怎样搜索？
```sql
SELECT * FROM 表名 WHERE 列名A REGEXP '\\.';
```
这并不是期望的输出，.匹配任意字符，因此每个行都被检索出
来。  
**为了匹配特殊字符，必须用\\为前导。\\-表示查找-，\\.表示查找.**



#### 9.联结

内部联结或等值联结（equijoin）的简单联结。现在来看3种其他联结，它们分别是自联结、自然联结和外部联结。







####  10.组 合 查 询

本章讲述如何利用UNION操作符将多条SELECT语句组合成一个结果

集。

 组合查询

多数SQL查询都只包含从一个或多个表中返回数据的单条SELECT语句。MySQL也允许执行多个查询（多条SELECT语句），并将结果作为单个查询结果集返回。这些组合查询通常称为并（union）或复合查询（compound query）。有两种基本情况，其中需要使用组合查询：

S 在单个查询中从不同的表返回类似结构的数据；

 对单个表执行多个查询，按单个查询返回数据。

<!-- ![image-20240716203721436](D:\desktop\笔记\img\Mysql必知必会\mysql1.png) -->

 UNION必须由两条或两条以上的SELECT语句组成，语句之间用关键字UNION分隔（因此，如果组合4条SELECT语句，将要使用3个UNION关键字）。

 UNION中的每个查询必须包含相同的列、表达式或聚集函数（不过各个列不需要以相同的次序列出）。

 列数据类型必须兼容：类型不必完全相同，但必须是DBMS可以隐含地转换的类型（例如，不同的数值类型或不同的日期类型）。如果遵守了这些基本规则或限制，则可以将并用于任何数据检索任务

小结

本章讲授如何用UNION操作符来组合SELECT语句。利用UNION，可把多条查询的结果作为一条组合查询返回，不管它们的结果中包含还是不包含重复。使用UNION可极大地简化复杂的WHERE子句，简化从多个表中检索数据的工作





#### 11.INSERT UPDATE DELETE

主键值必须唯一。即，表中的每个行必须具有唯一的主

键值。如果主键使用单个列，则它的值必须唯一。如果使用多个列，则

这些列的组合值必须唯一。





```sql
id                     int               NOT NULL            AUTO_INCREMENT,
```

AUTO_INCREMENT发挥作用的时候了。请看以下代码行（用来

创建customers表的CREATE TABLE语句的组成部分）：

AUTO_INCREMENT告诉MySQL，本列每当增加一行时自动增量。每次

执行一个INSERT操作时，MySQL自动对该列增量





为了使用ALTER TABLE更改表结构，必须给出下面的信息：

 在ALTER TABLE之后给出要更改的表名（该表必须存在，否则将

出错）；

 所做更改的列表。

下面的例子给表添加一个列

```sql
ALTER TABLE vendors ADD vend_phone CHAR(20);
```



删除刚刚添加的列，可以这样做：

```sql
ALTER TABLE Vendors DROP COLUMN vend phone;
```



ALTER TABLE的一种常见用途是定义外键。下面是用来定义本书中的

表所用的外键的代码

```sql
ALTER TABLE orderitemsADD CONSTRAINT fk_orderitems_orders FOREIGN KEY(order_num) REFERENCES orders(order_num);
ALTER TABLE orderitemsADD CONSTRAINT fk_orderitems_products FOREIGN KEY(prod id)REFERENCES products(prod id);
```



21.3 删除表

删除表（删除整个表而不是其内容）非常简单，使用DROP TABLE语

句即可：

这条语句删除customers 2表（假设它存在）。删除表没有确认，也不能撤销，执行这条语句将永久删除该表。

21.4 重命名表

使用RENAME TABLE语句可以重命名一个表

```sql
RENAME TABLE customer1 to customer2
```







#### 12 视图

视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询



为什么使用视图

我们已经看到了视图应用的一个例子。下面是视图的一些常见应用。

 重用SQL语句。

 简化复杂的SQL操作。在编写查询后，可以方便地重用它而不必知道它的基本查询细节。

 使用表的组成部分而不是整个表。

 保护数据。可以给用户授予表的特定部分的访问权限而不是整个表的访问权限。

 更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据

##### 更新视图

迄今为止的所有视图都是和SELECT语句使用的。然而，视图的数据

能否更新？答案视情况而定。

通常，视图是可更新的（即，可以对它们使用INSERT、UPDATE和

DELETE）。更新一个视图将更新其基表（可以回忆一下，视图本身没有数

据）。如果你对视图增加或删除行，实际上是对其基表增加或删除行。





#### 13 管理事务处理

事务处理（transaction processing）可以用来维护数据库的完整性，它保证成批的MySQL操作要么完全执行，要么完全不执行。

 事务（transaction）指一组SQL语句；

 回退（rollback）指撤销指定SQL语句的过程；

 提交（commit）指将未存储的SQL语句结果写入数据库表；

 保留点（savepoint）指事务处理中设置的临时占位符（placeholder），你可以对它发布回退（与回退整个事务处理不同）。

```sql

SELECT * FROM ordertotals;

START TRANSACTION;

DELETE FROM ordertotals;

SELECT * FROM ordertotals;

ROLLBACK;
SELECT * FROM ordertotals;
```



。这时用一条ROLLBACK语句回退START TRANSACTION之后的所有语句，最后一条SELECT语句显示该表不为空。

显然，ROLLBACK只能在一个事务处理内使用（在执行一条STARTTRANSACTION命令之后）。

哪些语句可以回退？ 事务处理用来管理INSERT、UPDATE和DELETE语句。你不能回退SELECT语句。（这样做也没有什么意

义。）你不能回退CREATE或DROP操作。事务处理块中可以使用这两条语句，但如果你执行回退，它们不会被撤销。





一般的MySQL语句都是直接针对数据库表执行和编写的。这就是所谓的隐含提交（implicit commit），即提交（写或保存）操作是自动进行的。

但是，在事务处理块中，提交不会隐含地进行。为进行明确的提交，使用COMMIT语句，如下所示：

```sql
START TRANSACTION;
DELETE FROM orderitems WHERE order_num=20010;
DELETE FROM orders WHERE order num=20010:
COMMIT;
```



##### 使用保留点

简单的ROLLBACK和COMMIT语句就可以写入或撤销整个事务处理。但是，只是对简单的事务处理才能这样做，更复杂的事务处理可能需要部分提交或回退。

例如，前面描述的添加订单的过程为一个事务处理。如果发生错误，只需要返回到添加orders行之前即可，不需要回退到customers表（如果存在的话）。

为了支持回退部分事务处理，必须能在事务处理块中合适的位置放置占位符。这样，如果需要回退，可以回退到某个占位符。这些占位符称为保留点。为了创建占位符，可如下使用SAVEPOINT